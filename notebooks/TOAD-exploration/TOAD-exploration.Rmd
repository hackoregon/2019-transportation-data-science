---
title: "TOAD data exploration"
output: html_notebook
---

## Libraries
```{r}
library(data.table)
library(downloader)
library(sf)

```

## Data
```{r}
stop_events <- fread("/csvs/raw_stop_event_2017_09.csv")
stop_events_key_cols <- c(
  "VEHICLE_NUMBER",
  "SERVICE_DATE",
  "ARRIVE_TIME",
  "LEAVE_TIME",
  "LOCATION_ID"
)
setkeyv(stop_events, stop_events_key_cols)

home <- setwd(tempdir())
download("https://developer.trimet.org/gis/data/tm_routes.zip",
         destfile = "tm_routes.zip"
)
unzip("tm_routes.zip")
tm_routes <- unique(as.data.table(read_sf("tm_routes.shp"))[, .(rte, type)])
setwd(home)
gc()

```

## Tag the stop event table with vehicle type
```{r}
stop_events <- merge(
  stop_events, tm_routes, by.x = "ROUTE_NUMBER", by.y = "rte", all = FALSE
)
gc()

```

